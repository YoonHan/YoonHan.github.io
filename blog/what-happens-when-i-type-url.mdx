---
title: 브라우저 주소창에 URL을 입력하면 일어나는 일들
publishedDate: 2022-02-20
author: Yoon
tag: Common
---

> 브라우저 주소창에 **maps.google.com**을 입력하면 일어나는 일에 대해 알아본다.<br /> 
  평소에도 어렴풋이는 떠올릴 수 있었는데 너무 큰 줄기만 알고 있던 것 같아, 복습 겸 구글링하여 공부를 해봤다.

<br />

## 1. 브라우저 주소창에 **maps.google.com** 을 입력한다.

## 2. 브라우저가 **maps.google.com** 도메인에 해당하는 IP 주소를 찾는다.
DNS는 Domain Name Server 의 약자로, 도메인 <-> IP 주소의 모음집이다. 일종의 전화번호부 같은거라고 생각하면 된다. <br />
사실, maps.google.com 이라는 도메인은 사람이 기억하기 쉽도록 IP주소에 붙여준 이름에 불과하다. 만약 DNS가 없다면 도메인 만으로 내가 접속하고자 하는 사이트에 접속할 수는 없다. <br />

브라우저는 이 DNS 기록을 찾아서 사용자가 입력한 도메인이 어떤 IP주소에 대응되는지를 먼저 찾게된다. <br />
찾는 과정에서 총 4개의 캐시를 순차적으로 탐색해 나간다.

- 첫 번째로, 브라우저가 자체적으로 가지고 있는 브라우저 캐시를 찾아본다. 브라우저는 사용자가 이전에 방문했던 사이트의 DNS 기록을 일정기간 보유하고 있는데 이 부분을 제일 먼저 찾아보는 것이다. <br />
  만약 이 단계에서 DNS 기록을 찾았다면 해당 IP주소로 바로 요청을 보내게 된다.
- 두 번째로, 브라우저 캐시에서 찾지 못했다면 OS 캐시를 찾아본다. OS에서도 캐시를 보유하고 있기 때문이다.
- 세 번째로, OS 캐시에서도 찾지 못했다면 네트워크 라우터 캐시를 찾아본다.
- 마지막으로, 네트워크 라우터 캐시에서도 찾지 못했다면 ISP 캐시를 찾아본다. ISP(Internet Service Provider)란 말그대로 인터넷 서비스를 제공해주는 사업자인데 우리나라에서는 KT, SKT LG유플러스 같은 곳이 ISP이다. <br />
  
## 3. ISP의 DNS 서버가 **maps.google.com** 에 대한 DNS 쿼리를 보낸다.
그 어느 캐시에서도 URL에 해당하는 IP주소를 찾을 수 없다면, ISP는 DNS 서버에 '이 도메인을 가진 호스트의 IP 주소를 찾아주세요' 하는 요청을 보낸다. <br />

잠시 도메인 아키텍쳐에 대해 살펴보면, 아래 그림과 같다.

![도메인 아키텍쳐](./images/what-happens-when-i-type-url/domain-hierarchy.png)

도메인 이름은 3개의 계층으로 이루어지는데 각 계층마다 자체적인 네임서버를 가지고 있다. <br />
maps.google.com 도메인의 경우 루트 네임서버가 **.com** 네임 서버로 요청을 넘겨주고, **.com** 네임 서버가 **google.com** 네임 서버로 요청을 다시 넘겨준다. <br />
**google.com** 네임 서버는 자기가 가진 DNS 레코드 중에서 **maps.google.com** 에 해당하는 레코드를 찾아내고 그것을 응답으로 돌려준다. <br />
해당 응답을 돌려받은 DNS recursor는 브라우저에게 그 응답을 돌려준다. 여기에서 DNS recursor 는 브라우저(클라이언트)와 DNS 서버 간 통신을 중재해주는 역할을 한다. <br />

## 4. 브라우저가 해당 IP주소에 있는 서버와 TCP 연결을 맺는다.
브라우저는 응답받은 IP주소로 TCP 연결을 맺는다. TCP 연결을 맺을 때는 **three way handshake** 방식을 통해 맺는데, 본격적으로 데이터 패킷을 보내기 전 연결을 확정 짓는 단계라고 보면 된다. <br />

## 5. 브라우저가 서버로 HTTP 요청을 보낸다.
TCP 연결이 정상적으로 이루어지면, 서버로 데이터를 보낼 차례다. 브라우저는 GET HTTP 요청을 통해 maps.google.com 의 웹페이지 정보를 요청한다. <br />

## 6. 서버가 응답을 보낸다.
요청을 받은 서버는, 요청에 담긴 정보를 해석에 그에 맞는 응답을 브라우저에게 돌려준다. 응답에 포함되는 정보는 상태 코드, 캐시 정책, 컨텐츠 인코딩 방식 등이다.

## 7. 브라우저가 HTML을 해석하고 보여준다.
응답받은 HTML 문서를 브라우저가 한줄 한줄 읽어내려가며 **DOM 트리** 라는 것을 구성한다. 읽어내려가다가 **`<style>`** 태그나 **`<script>`** 태그를 만나면 CSS나 JavaScript 리소스를 요청한다. <br />
이러한 리소스들은 다음에 다시 받아올 필요가 없도록 브라우저가 캐시를 해둔다. <br />
**DOM 트리**에 더해 CSS 스타일을 통해 **CSSOM 트리**라는 것도 구성하는데, 이 둘을 합쳐 **렌더 트리**를 완성하게 되고 이를 기반으로 렌더링이 이루어진다. <br />
이 때 비로소 사용자가 maps.google.com 페이지의 화면을 보게 되는 것이다.


### References
- [What happens when you type a URL in the browser and press enter?](https://medium.com/@maneesha.wijesinghe1/what-happens-when-you-type-an-url-in-the-browser-and-press-enter-bb0aa2449c1a)
